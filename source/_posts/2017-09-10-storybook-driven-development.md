---
title: storybook驱动组件化开发
date: 2017-09-10 11:16:01
tags: [storybook]
---



## 简单介绍下组件化开发方案





## 前端在组件化开发遇到的困扰

如何做组件化开发

如何插入到工作流中 React组件UI开发环境，其作用在于让前端工程师专注在样式，组件功能开发过程中。

1.多人开发流程 经常遇到的问题

在组件化开发方案下，强调业务任务和组件任务的分离和协同。组件任务具有很强的独立性和自治性，即在接口定义清楚的情况下，完全可以抛开上下文进行开发。这类任务对外无任何依赖，再加上组件的职责单一性，其功能也很容易被开发者理解。所以在安排任务上，组件任务可以非常灵活。而业务任务只需关注自己依赖的组件是否已经完成，一旦完成就马上进入Ready For Dev状态，以最高优先级等待下一位开发人员选取。

一个页面还没有ready架子，你需要的，

这里要画张图片 流程图来表示 要ready 架子开发 是怎么样的，不需要的是怎么样子的





2.深层次的组件

那么如果我们需要修改一个很深很深的组件里的样式，我们是不是要一次一次戳按钮点进去？当你修改了这个很深很深的组件，发现样式热替换挂了，这有时候是玄学，你需要手动刷新整个应用，你是否肯任劳任怨地重新戳回去一次？一次又一次？

点击弹窗等等，截个gif

3.mock数据 和 运行环境

那么如果我们要看下某些数据流下的组件展示是否正常，那么先配置下假数据转发，保证数据流是正常的，完了你再找到你要调试的组件进行调试，调试完了这个mock数据，你再切换到下个mock数据，在调试下这个数据流是否是你想要展示的样子，重复一次又一次。或者说需要特定运行环境下，测试组件是否正常

4.组件的状态特别多

比方这个组件，SVIP会员专属的展示，限时免费的选中态展示，用户有折扣券的展示，用户有免费券的展示



## 那么如何解决呢  独立的进行组件设计和开发的环境

这里看下是怎么的一种形式，我们很容易想到就是单独写个页面，写好容器组件，在开始写你的组件，

关键代码贴下

开始写你的代码



但是这样虽然有了独立的组件she



## 介绍Storybook

贴图片

说明下

**“StoryBook”是一种允许我们在孤立环境中设计和开发真实应用程序外的组件的工具。可以应用在 web 端和 native 端，将每个组件看作一组故事，然后用 Storybook 左边的书签在故事之间快速跳转。支持React Vue React-Native。**



介绍下Storybook界面，左边填写是什么东西，用官方的gif即可，iframe，storybook 会把我们编写的所有UI组件的各种状态下的表现渲染出来。





在 @kadira/Storybook 的辅助下，我们可以把组件化开发开发效率提升



接下来我们看下怎么安装storybook,



## 安装storybook

三行代码

简单说get 哪行代码会分析你的package.json，完了根据不同框架来添加安装对应所需的package。



## 编写story

简单贴 几行代码，演示下各个状态下的组件展示



## 这样子有了独立的UI组件开发环境

我们的协作效率大大提升，我们也不再需要说需要等页面架子搭建好了，才能做对应的组件开发，业务数据逻辑也是可以一起开发的。



再来到另一个场景

多人开发流程 经常遇到的问题，之前让你开发的组件点击按钮没有反应啊，团队需要Living Style Guide之类的工具帮助验收组件任务，你这个组件这个点击没有反应啊多人不再需要说我们的验收会出现问题，



接下来我们讲下如何也就是针对上面的问题，我们要采取的验收方案

## 可视化地测试可复用组件

UI组件不同于TDD之流，怎么讲 只能可视化的测试，以后生成截图来对比。当然有些情况还得手动操作下进行测试。



可复用组件的一个好处是，你可以在任何地方渲染他们，因为他们不依赖复杂的环境。当它们被用在组件展列、调试应用时，这一点就非常有用了。在这些应用中，你可以展列、可视化和测试你的 UI 组件。

一个组件展列器会做两件事情：

1. **展列**你的应用组件以便能轻易地找到他们。
2. 使用开发者定义的状态和伪数据来**渲染**这些组件。

例如，在 Galaxy 中，我们使用一个被称作 Chromatic 的组件展列器来一次一个或一次全部的形式来渲染组件。



## 接下来看下两个可视化测试例子

## 放在css is awesome  的图片。

正常的情况

放代码，我是一个很长的名字~，发现你的组件异常了，

写个测试用例overflow名字隐藏起来，可以用插件暴力的填写超长的名字

在UI组件开发的使用就及时暴露问题



### 操作动画

UI组件其实不关心他的state

它在不超过指定宽度的时候，不会添加滑动操作的

超过指定宽度的时候，可以进行左右滑动操作



好了，某天这个tab数量越来越多，你会发现有bug出现了，下方线条动画工作不正常



## 讲下暴力设置各种情况来测试

贴图就行了orz 没用过

Storybook Addon Knobs 可以让你在 Storybook 页面上动态调整传给组件的 props，很适合用于展示。

这样子你就不需要 设置自己的QQ昵称特别长 还有各种xss







## 这个怎么讲呢 沟通场景遇到的困扰

在前端开发时，经常存在这样的沟通场景：

- 开发人员和UX验证页面设计时，因为一些细微的差异对UI进行反复的小修改。
- 开发人员和业务人员验证界面流程时，因为一些特别的需求对UI进行反复的小修改。
- 开发人员想复用另一个组件，寻找该组件的开发人员了解该组件的设计和职责
- 开发人员和QA一起验证某个公用组件改动对多个界面上的影响



感觉 我讲的东西有点偏向重构的工作



有些时候很难去查阅你在哪个页面使用了哪个组件。这里你可以使用一个监视器组件来查询你使用的组件。这在很多时候非常便利，譬如你想升级某一个组件，你会想去了解哪些页面或是组件依赖了这个组件从而进行修改，DW 提供了一个实现，我们可以根据我们的需求来实现自己的 Monitor Component。



大厂会自研组件化展示平台以及各种功能，那么我就是想有个静态文档说明，来满足UI UX 前端们 复用走查呢



如何应对频繁的需求变更可能引起的，回顾测试 loko 因为state特别多，根本不知道在哪一步处理的

如何发布共享复用，文档说明，props说明 已经 可用的props自动调试

部署静态文件文档说明



IDP 从代码的加载模式首屏加载 预加载 懒加载，来判定是否为高频首屏模块进行combo

这个需要了解我们的模块加载所需的知识，预加载通过判定是否需要加载，加载的大小记录 事件



从设计稿中识别出那些是可以复用的组件，机器学习，这样子设计师 是怎么复用的？